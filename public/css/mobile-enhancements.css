/**
 * Mobile Enhancements - Additional Mobile Optimizations
 * Advanced mobile UX patterns and performance optimizations
 */

/* ===================================================================
   PWA INSTALL BANNER
   =================================================================== */

.install-banner {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-secondary) 100%);
    color: white;
    z-index: var(--z-toast);
    padding: var(--mobile-padding);
    box-shadow: 0 -4px 6px -1px rgba(0, 0, 0, 0.1);
    transform: translateY(100%);
    transition: transform var(--mobile-animation-duration) ease-out;
    animation: slideUpBanner 0.3s ease-out forwards;
}

@keyframes slideUpBanner {
    to {
        transform: translateY(0);
    }
}

.install-content {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--mobile-gap);
    max-width: 600px;
    margin: 0 auto;
}

.install-content span {
    flex: 1;
    font-size: var(--mobile-text-sm);
    font-weight: 500;
}

.install-content .btn {
    white-space: nowrap;
    min-height: 36px;
    font-size: var(--mobile-text-sm);
}

.install-content .btn-primary {
    background: white;
    color: var(--color-primary);
    border: none;
}

.install-content .btn-outline {
    background: transparent;
    color: white;
    border: 1px solid white;
    min-width: 36px;
    padding: 8px;
}

/* ===================================================================
   PWA MODE OPTIMIZATIONS
   =================================================================== */

.pwa-mode {
    /* Remove browser chrome adjustments */
    --mobile-header-height: 80px;
}

.pwa-mode .header {
    padding-top: env(safe-area-inset-top);
}

.pwa-mode .main {
    padding-bottom: env(safe-area-inset-bottom);
}

/* iOS PWA status bar */
.pwa-mode body {
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    user-select: none;
}

.pwa-mode input,
.pwa-mode textarea,
.pwa-mode [contenteditable] {
    -webkit-user-select: text;
    user-select: text;
}

/* ===================================================================
   ENHANCED TOUCH TARGETS
   =================================================================== */

@media (max-width: 768px) {
    /* Ensure all interactive elements meet touch target guidelines */
    button,
    input[type="button"],
    input[type="submit"],
    input[type="color"],
    .color-preview,
    .swatch-color,
    .nav-button,
    .modal-close,
    .panel-close,
    .toast-close {
        min-height: var(--touch-target-min);
        min-width: var(--touch-target-min);
        position: relative;
    }

    /* Add touch feedback */
    button:active,
    input[type="button"]:active,
    input[type="submit"]:active,
    .color-preview:active,
    .swatch-color:active {
        transform: scale(0.98);
    }

    /* Enhanced button spacing */
    .form-actions,
    .results-actions {
        gap: var(--mobile-margin);
    }

    .form-actions .btn,
    .results-actions .btn {
        min-height: var(--touch-target-comfortable);
        padding: 14px 20px;
    }

    /* Color picker enhancements */
    .color-input {
        min-height: var(--touch-target-large);
        border-radius: var(--border-radius-lg);
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .color-input:focus,
    .color-input:active {
        outline: none;
        box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.2);
        transform: scale(1.02);
    }

    /* Hex input improvements */
    .hex-input {
        min-height: var(--touch-target-min);
        font-size: var(--mobile-text-base);
        padding: 12px 16px;
        border-radius: var(--border-radius-md);
    }

    .hex-input:focus {
        outline: none;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
    }
}

/* ===================================================================
   MOBILE NAVIGATION ENHANCEMENTS
   =================================================================== */

@media (max-width: 768px) {
    /* Sticky navigation improvements */
    .header {
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        background: rgba(255, 255, 255, 0.95);
        border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    }

    /* Navigation button enhancements */
    .nav-button {
        position: relative;
        overflow: hidden;
        transition: all 0.2s ease;
    }

    .nav-button::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        background: rgba(102, 126, 234, 0.1);
        border-radius: 50%;
        transform: translate(-50%, -50%);
        transition: width 0.3s ease, height 0.3s ease;
    }

    .nav-button:active::before {
        width: 100px;
        height: 100px;
    }

    /* Mobile breadcrumb navigation */
    .mobile-breadcrumb {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: var(--mobile-gap) var(--mobile-padding);
        background: var(--color-gray-50);
        border-bottom: 1px solid var(--color-gray-200);
        font-size: var(--mobile-text-sm);
        color: var(--color-gray-600);
    }

    .mobile-breadcrumb .breadcrumb-item {
        display: flex;
        align-items: center;
        gap: 4px;
    }

    .mobile-breadcrumb .breadcrumb-separator {
        color: var(--color-gray-400);
    }

    .mobile-breadcrumb .breadcrumb-current {
        color: var(--color-primary);
        font-weight: 600;
    }
}

/* ===================================================================
   GESTURE FEEDBACK ANIMATIONS
   =================================================================== */

@media (max-width: 768px) {
    /* Touch ripple effect */
    .touch-ripple {
        position: relative;
        overflow: hidden;
    }

    .touch-ripple::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        background: rgba(255, 255, 255, 0.5);
        border-radius: 50%;
        transform: translate(-50%, -50%);
        animation: ripple 0.6s ease-out;
        pointer-events: none;
    }

    @keyframes ripple {
        to {
            width: 200px;
            height: 200px;
            opacity: 0;
        }
    }

    /* Long press visual feedback */
    .long-press-active {
        animation: longPressIndicator 0.5s ease-in-out;
    }

    @keyframes longPressIndicator {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.05); }
    }

    /* Swipe gesture indicators */
    .swipe-indicator {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: rgba(102, 126, 234, 0.8);
        color: white;
        padding: 8px 12px;
        border-radius: 20px;
        font-size: var(--mobile-text-xs);
        font-weight: 600;
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.2s ease;
    }

    .swipe-indicator.left {
        left: 20px;
    }

    .swipe-indicator.right {
        right: 20px;
    }

    .swipe-indicator.active {
        opacity: 1;
    }
}

/* ===================================================================
   MOBILE MODAL IMPROVEMENTS
   =================================================================== */

@media (max-width: 768px) {
    /* Enhanced modal animations */
    .modal {
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
    }

    .modal-content {
        border-radius: var(--border-radius-xl) var(--border-radius-xl) 0 0;
        box-shadow:
            0 -10px 25px -5px rgba(0, 0, 0, 0.1),
            0 -4px 6px -4px rgba(0, 0, 0, 0.1);
    }

    /* Drag indicator for modals */
    .modal-content::before {
        content: '';
        position: absolute;
        top: 12px;
        left: 50%;
        transform: translateX(-50%);
        width: 40px;
        height: 4px;
        background: var(--color-gray-300);
        border-radius: 2px;
    }

    .modal-header {
        padding-top: calc(var(--mobile-padding) + 8px);
    }

    /* Pull-to-close indicator */
    .modal-pull-indicator {
        position: absolute;
        top: -30px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.6);
        color: white;
        padding: 8px 16px;
        border-radius: 20px;
        font-size: var(--mobile-text-xs);
        opacity: 0;
        transition: opacity 0.2s ease;
        pointer-events: none;
    }

    .modal-pull-indicator.active {
        opacity: 1;
    }
}

/* ===================================================================
   PERFORMANCE OPTIMIZATIONS
   =================================================================== */

@media (max-width: 768px) {
    /* Hardware acceleration for smooth scrolling */
    .modal-body,
    .panel-body,
    .results-container {
        transform: translateZ(0);
        -webkit-transform: translateZ(0);
    }

    /* Optimize animations for mobile */
    @media (prefers-reduced-motion: reduce) {
        * {
            animation-duration: 0.01ms !important;
            animation-iteration-count: 1 !important;
            transition-duration: 0.01ms !important;
        }
    }

    /* Content visibility optimization */
    .results-section {
        content-visibility: auto;
        contain-intrinsic-size: 500px;
    }

    .accessibility-panel {
        content-visibility: auto;
        contain-intrinsic-size: 600px;
    }

    /* Lazy loading for images */
    img {
        loading: lazy;
    }

    /* Font optimization */
    body {
        font-display: swap;
    }
}

/* ===================================================================
   MOBILE-SPECIFIC ACCESSIBILITY
   =================================================================== */

@media (max-width: 768px) {
    /* Enhanced focus indicators for mobile */
    *:focus {
        outline: 3px solid var(--color-primary);
        outline-offset: 2px;
    }

    /* Screen reader improvements */
    .sr-mobile-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
    }

    /* Touch target labels */
    .touch-label {
        font-size: var(--mobile-text-xs);
        color: var(--color-gray-600);
        margin-top: 4px;
        text-align: center;
    }

    /* High contrast mode improvements */
    @media (prefers-contrast: high) {
        .btn {
            border: 2px solid currentColor;
        }

        .color-preview,
        .swatch-color {
            border: 3px solid var(--color-gray-800);
        }

        .modal-content,
        .panel-content {
            border: 2px solid var(--color-gray-800);
        }
    }
}

/* ===================================================================
   LOADING AND SKELETON STATES
   =================================================================== */

@media (max-width: 768px) {
    /* Loading skeleton for color palettes */
    .skeleton-swatch {
        background: linear-gradient(
            90deg,
            var(--color-gray-200) 25%,
            var(--color-gray-100) 50%,
            var(--color-gray-200) 75%
        );
        background-size: 200% 100%;
        animation: skeleton-loading 1.5s infinite;
        border-radius: var(--border-radius-md);
        height: 80px;
    }

    @keyframes skeleton-loading {
        0% { background-position: 200% 0; }
        100% { background-position: -200% 0; }
    }

    /* Loading spinner improvements */
    .mobile-spinner {
        width: 24px;
        height: 24px;
        border: 2px solid var(--color-gray-300);
        border-top: 2px solid var(--color-primary);
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
}

/* ===================================================================
   ORIENTATION HANDLING
   =================================================================== */

@media (max-width: 768px) and (orientation: landscape) {
    .header {
        height: 60px;
    }

    .header-content {
        min-height: 60px;
        padding: 8px 0;
    }

    .title-main {
        font-size: var(--mobile-text-base);
    }

    .title-subtitle {
        display: none;
    }

    .color-pickers-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: var(--mobile-gap);
    }

    .room-preview {
        height: 150px;
    }

    .preview-room {
        height: 120px;
    }
}

/* ===================================================================
   NOTCH AND SAFE AREA SUPPORT
   =================================================================== */

@supports (padding-top: env(safe-area-inset-top)) {
    .header {
        padding-top: env(safe-area-inset-top);
    }

    .main {
        padding-bottom: env(safe-area-inset-bottom);
    }

    .install-banner {
        padding-bottom: calc(var(--mobile-padding) + env(safe-area-inset-bottom));
    }

    .modal,
    .accessibility-panel {
        padding-bottom: env(safe-area-inset-bottom);
    }
}

/* ===================================================================
   DARK MODE MOBILE OPTIMIZATIONS
   =================================================================== */

@media (prefers-color-scheme: dark) and (max-width: 768px) {
    .header {
        background: rgba(23, 23, 23, 0.95);
        border-bottom-color: rgba(255, 255, 255, 0.1);
    }

    .install-banner {
        background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
    }

    .mobile-breadcrumb {
        background: var(--color-gray-800);
        border-bottom-color: var(--color-gray-700);
    }

    .skeleton-swatch {
        background: linear-gradient(
            90deg,
            var(--color-gray-700) 25%,
            var(--color-gray-600) 50%,
            var(--color-gray-700) 75%
        );
    }
}